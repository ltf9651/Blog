## 04 | 深入浅出索引（上）
1. 索引的作用：提高数据查询效率 
1. 常见索引模型：哈希表、有序数组、搜索树 
1. 哈希表：键 - 值(key - value)。 
1. 哈希思路：把值放在数组里，用一个哈希函数把key换算成一个确定的位置，然后把value放在数组的这个位置 
1. 哈希冲突的处理办法：链表 
1. 哈希表适用场景：只有等值查询的场景 
1. 有序数组：按顺序存储。查询用二分法就可以快速查询，时间复杂度是：O(log(N)) 
1. 有序数组查询效率高，更新效率低 
1. 有序数组的适用场景：静态存储引擎。 
1. 二叉搜索树：每个节点的左儿子小于父节点，父节点又小于右儿子 
1. 二叉搜索树：查询时间复杂度O(log(N))，更新时间复杂度O(log(N)) 
1. 数据库存储大多不适用二叉树，因为树高过高，会适用N叉树 
1. InnoDB中的索引模型：B+Tree 
1. 索引类型：主键索引、非主键索引 

基于主键索引和普通索引的查询的区别
  - 如果语句是 select * from T where ID=500，即主键查询方式，则只需要搜索 ID 这棵 B+ 树；
  - 如果语句是 select * from T where k=5，即普通索引查询方式，则需要先搜索 k 索引树，得到 ID 的值为 500，再到 ID 索引树搜索一次。这个过程称为回表

基于非主键索引的查询需要多扫描一棵索引树。因此，我们在应用中应该尽量使用主键查询
从性能和存储空间方面考量，自增主键往往是更合理的选择。

有没有什么场景适合用业务字段直接做主键的呢？还是有的。比如，有些业务的场景需求是这样的：
- 只有一个索引；
- 该索引必须是唯一索引。

这就是典型的 KV 场景。

由于没有其他索引，所以也就不用考虑其他索引的叶子节点大小的问题。

这时候我们就要优先考虑上一段提到的“尽量使用主键查询”原则，直接将这个索引设置为主键，可以避免每次查询需要搜索两棵树。

```
// 1
alter table T drop index k;
alter table T add index(k);

// 2
alter table T drop primary key;
alter table T add primary key(id);

如果删除，新建主键索引，会同时去修改普通索引对应的主键索引，性能消耗比较大。 
删除重建普通索引貌似影响不大，不过要注意在业务低谷期操作，避免影响业务。 
```