## 管道

两次独立的读写操作会花费两次网络来回。

两个连续的写操作和两个连续的读操作总共只会花费一次网络来回，就好比连续的 write 操作合并了，连续的 read 操作也合并了一样。

客户端通过对管道中的指令列表改变读写顺序就可以大幅节省 IO 时间。管道中指令越多，效果越好。QPS可达10W/S。

Redis中`read`和`write`是异步的，并不关心执行结果，剩下的事务交给系统内核操作。`write` 操作只负责将数据写到本地操作系统内核的发送缓冲然后就返回了，`read` 操作只负责将数据从本地操作系统内核的接收缓冲中取出来就了事了。

一个网络来回的真正开销主要来自`read`，`write`操作几乎没有耗时。因为`read`要等待消息经过网络路由到目标机器处理后的响应消息,再回送到当前的内核读缓冲才可以返回。

管道改变了消息发送的顺序，一次性发送大量 write 然后 read 只需要等待一次网络往返开销就可以读取到所有响应了。


好比网购，买多件东西分开下单，会比较慢，假如一次下单买多个就比较快，而write好比是下单操作或是卖家发货很快，read好比是收快递，耗时的是快递小哥