## 切片集群方案

Codis、Redis Cluster

![](https://github.com/ltf9651/Blog/blob/master/Redis/Core/cluster.png)

1. Codis 业界应用得早，更成熟
1. Codis 兼容性更强，业务中大量单实例客户端可以直接升级到切片集群，Redis Cluster 需要修改代码
1. Redis Cluster 对 Redis 新版本适应性更强
1. Codis 更适合数据迁移

## 数据倾斜

在使用 Redis Cluster 或 Codis 时，数据都会先按照 CRC 算法的计算值对 Slot（逻辑槽）取模，同时，所有的 Slot 又会由运维管理员分配到不同的实例上。这样，数据就被保存到相应的实例

问题
  - 在某些情况下，实例上的数据分布不均衡，某个实例上的数据特别多
  - 虽然每个集群实例上的数据量相差不大，但是某个实例上的数据是热点数据，被访问得非常频繁

解决
  - 拆分 bigkey 为小的数据，分散保存在不同实例
  - 迁移 slot
  - 不要使用 Hash Tag 进行数据切片
  - 热点数据多副本，每个副本在 key 中随机前缀，让副本数据分配到不同的实例
