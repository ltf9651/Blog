## 聚合分析

Aggregation：es 除搜索功能之外提供的数据统计分析功能
  - 功能丰富，提供 Bucket、Metric、Pipeline 等多种分析方式
    - Bucket 分桶类型，类似 groub by
    - Metric 指标分析，计算最大值、平均值等
    - Pipeline 管道分析，基于上一级的聚合分析结果进行再分析
    - Matrix 矩阵分析
  - 实时性高

```
GET test_index/_search
{
    "size:"0, //不输出文档
    "aggs":{
        "<aggregation_name>":{
            "<aggregation_type>":{
                "<aggregation_body>"
            }
            [,"aggs":{}] //子查询
        }
        [,"<aggregation_name_2>"]//多个聚合分析
    }
}
```

### Metric

- 单值分析
  - 只输出一个分析结果
  - min,max,avg,sum
  - cardinality 类似 distinct count
- 多值分析
  - 输出多个结果
  - stats,extended stats 方差、标准差等
  - percentile,percentile rank 百分位数统计
  - top hits 分桶后获取桶内最匹配的顶部文档列表

```
GET test_index/_search
{
    "aggs":{
        "min_age":{
            "min":{
                "field":"age"
            }
        },
        "max_age":{
            "max":{
                "field":"age"
            }
        },
    }
}
```
