## 服务化

### 一体化架构

- 优势
  - 开发简单直接，代码和项目集中式管理
  - 只需要维护一个工程
  - 排查的时候方便，目标性强
- 缺点
  - 数据库连接数可能成为系统瓶颈
  - 模块之间依赖性强，耦合度高，测试麻烦
  - 部署成本高，上线更新不灵活

### 微服务化

#### 拆分原则

- 单一服务内部功能的高内聚、低耦合，每个服务只完成自己职责之内的内务
- 先粗略拆分，后逐渐细化
- 拆分的过程要尽量避免影响产品的日常功能迭代
- 服务接口的定义要具备可扩展性

#### 问题解决

- 服务接口的调用为跨进程的网络调用，会增加接口的响应时间，接口调用方需要知道服务部署在哪些机器的哪个端口，需要引入服务注册中心
- 一个服务所依赖的其他服务发生故障时，会产生大量的慢请求，该服务也出现性能问题，需要引入服务治理
- 服务拆分到多个进程中，一条请求的调用链路上涉及多个服务，一旦这个请求的响应时间增长或者出现错误，很难排查时哪个服务出现问题，需要引入分布式追踪工具和细致的服务监控

### RPC

- RPC 过程
  - 客户端首先将调用的类名、方法名、参数名、参数值等信息序列化成二进制流
  - 客户端将二进制流通过网络发送给服务端
  - 服务端接收到二进制流之后将它反序列化，得到需要调用的类名、方法名、参数名、参数值，在通过动态代理的方式，调用对应的方法得到返回值
  - 服务端将返回值序列化，在通过网络发送给客户端
  - 客户端对结果反序列化之后就可以得到调用的结果
