## 计数系统设计

计数系统业务特点
 - 数据量巨大
 - 访问量大
 - 可用性、数字准确性要求高

### 数据存储

1. 数据库 + 缓存是初级阶段，量级不大时使用
1. 通过对原生 Redis 改造，可以极大地减少内存开销
  - 原生 Redis 使用字符串进行存储，空间站永达
  - 可以去除原生 Redis 的多余指针
  - 使用新的数组结构存储信息
1. 采用 SSD + 内存的方案，SSD 存冷数据，内存存储热数据

### 未读数设计

关键点
  - 用户访问系统通知页面需要设置未读数为 0，将用户最近看过的通知 ID 设为最新的一条系统通知 ID
  - 如果最近看过的通知 ID 为空，则认为是新用户，返回未读数 0
  - 对于非活跃用户，清空通知 ID，节省存储成本

信息流未读系统
  - 在通用计数器记录每一个用户发布的博文数
  - 在 Redis/Mem 中记录一个人所有关注人的博文快照数，当用户点位未读消息重置未读数为 0 时，将它关注所有人的博文数刷新到快照
  - 关注所有人的博文总数 - 快照中的博文总数 = 信息流未读数
