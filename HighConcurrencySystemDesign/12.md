## 数据迁移

迁移目标
  - 在线迁移，迁移的同时支持数据写入
  - 保证数据完整性
  - 支持回滚，对系统可用性不造成影响

### 双写方案

1. 把新的库配置为源库的从库，用来同步数据
1. 改造业务代码，在数据写入的时候，旧库和新库都写入数据（考虑异步写入新库），双写之前要将同步断掉
1. 数据校验
1. 将读流量切换到新库，保障可用性
1. 观察，没有问题后将双写改成写新库，迁移完成

迁移过程可以随时回滚，风险低

迁移时间周期长，需要改造应用代码

### 级联同步方案

1. 把新库配置为旧库的从库，同步数据
1. 再将一个备库配置为新库的从库，用做备份
1. 等三个库写入一致后，将数据库的读流量切换到新库
1. 暂停应用的写入，将写入流量切换到新库

简单易实施，没有改造业务的成本

需要短暂停止写入

### 数据迁移时预热缓存

1. 部署多组副本组，机房收到写入请求时优先写入机房的缓存节点，异步写入云上节点
1. 处理机房读请求时，指定一定的流量，优先走云上的缓存节点
1. 当云上缓存节点命中率达到 90% 以上时，在云上部署应用服务器，完全走云上缓存节点
