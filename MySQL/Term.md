## 基础概念

### MySQL查询处理过程
1. Client端发送请求到MySQL服务器
1. 服务器检查是否可在查询缓存中命中该SQL，如果可以则立即返回
1. 服务器进行SQL解析、预处理，再由优化器生成对应的执行计划
1. 根据执行计划、调用存储引擎API查询数据

### 相关概念

- 事务
  - ACID特性（原子、隔离、一致、持久）
  - 作为单逻辑工作单元执行的一系列操作
  - 没有事务会造成脏读、幻读、丢失修改、非重复读

- 错读
  - 脏读： 事务A读取了事务B更新的数据，但是事务B发生回滚
  - 不可重复度：事务A多次读取同一数据，事务B在事务A多次操作过程中更新了数据并提交，导致事务A多次读取结果不一致
  - 幻读：事务A对表进行排序，事务B对表插入一条数据，事务A排序完成后发现还有一条未处理记录

- 锁
  - 行级锁：只针对当前操作的行进行加锁
    - 优点：并发度高，锁冲突概率低
    - 缺点：系统开销大，速度较慢
  - 表级锁：对当前操作的表加锁
    - 优点：开销小，速度快
    - 缺点：并发度低，锁冲突概率高
  - 页级锁：介于行级锁与表级锁之间

- 死锁：多个事务在同一资源上相互占用，并请求锁定对付的资源，导致恶性循环

  解决思路：
    1. 不同程序并发存取多个表时约定以相同的顺序访问表
    1. 同一事物中尽量做到i一次锁死所有资源
    1. 升大锁粒度
    1. 分布式事务锁、乐观锁

- MySQL生命周期
```
建立连接->MySQL进程获取sql->解析、生成计划执行->读取数据到内存并进行逻辑处理->发送结果到客户端->关闭连接、释放资源
```

- 乐观锁：将在事务执行时申请锁定，防止他人对齐修改
  - 执行完毕再进行释放
  - 影响并发能力

- 悲观所：读取数据时不上锁，提交更喜欢你是进行判断是否有更新
  - 适用于读多写少的场景
  - 可提高吞吐量