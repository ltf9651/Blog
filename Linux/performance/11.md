## 内存问题定位

`free`,`/proc/meminfo`：系统已用、可用、剩余内存、缓存和缓冲区使用量

`top`,`ps`：进程虚拟、常驻、共享内存和缺页异常

`vmstat`：系统剩余内存、缓存、缓冲区、换入、换出

`sar`：系统内存换页情况、内存使用率、缓存和缓冲区使用量、Swap 使用情况

`cachestat`,`cachetop`：系统缓存和缓冲区命中率

`pmap`,`/proc/pid/smaps`：进程地址空间和内存状态

`valgrind`,`memleak`，`systemtap`：内存错误、泄漏检测、动态追踪

`pcstat`：查看指定文件的缓存情况

分析思路
 - 先用 free 和 top，查看系统整体的内存使用情况
 - 再用 vmstat 和 pidstat，查看一段时间的趋势，从而判断出内存问题的类型
 - 最后进行详细分析，比如内存分配分析、缓存 / 缓冲区分析、具体进程的内存使用分析等

优化思路
 - 禁止 Swap
 - 减少内存动态分配
 - 尽量使用缓存和缓冲区访问数据
 - 使用`cgroups`等方式限制进程的内存使用情况
 - 通过 `/proc/pid/oom_adj` ，调整核心应用的 oom_score。这样，可以保证即使内存紧张，核心应用也不会被 OOM 杀死
