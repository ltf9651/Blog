## 平均负载（Load Average）

```sh
> uptime
10:50:55 up 999 days,  1:14,  1 user,  load average: 0.64, 0.81, 1.00
```

- 当前时间
- 系统运行时间
- 正在登陆用户数
- 过去 1 分钟负载
- 过去 5 分钟负载
- 过去 15 分钟负载

平均负载：单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数

可运行状态：正在使用 CPU 或者等待 CPU 的进程（使用`ps`命令处于 R 状态的进程）

不可中断状态的进程：正处于内核态关键流程中的进程，并且这些进程是不可打断的（为了保证数据的一致性），比如等待硬件设备的 I/O 响应（`ps`命令处于 D 状态）

当平均负载比 CPU 个数大，说明系统出现过载。当平均负载高于 CPU 数量 70% 的时候，就应该分析排查负载高的问题，一旦负载过高，就可能导致进程响应变慢，进而影响服务的正常功能

平均负载不仅包括了正在使用 CPU 的进程，还包括等待 CPU 和等待 IO 的进程

CPU 使用率是单位时间内 CPU 繁忙情况的统计

CPU 密集型进程，使用大量 CPU 会导致平均负载升高，此时这两者是一致的

I/O 密集型进程，等待 I/O 也会导致平均负载升高，但 CPU 使用率不一定很高

大量等待 CPU 的进程调度也会导致平均负载升高，此时的 CPU 使用率也会比较高

stress：Linux 系统压力测试工具

sysstat：包含常用的 Linux 性能工具们用来监控和分析系统的性能

mpstat：常用的多和 CPU 性能分析工具，用来实时查看每个 CPU 的性能指标和平均指标

pidstat：进程性能分析工具，实时查看进程的 CPU、内存、I/O 和上下文切换等性能指标

```sh
# 压测
stress --cpu 8 --timeout 600

# 查看平均负载
watch -d uptime

# 查看进程CPU使用情况
pidstat -u 5 1

# 查看CPU使用率变化
mpstat -P ALL 5
```
