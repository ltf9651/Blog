## I/O 复用

- I/O 复用能使程序同事间厅多个文件描述符，提高性能
- 使用场景
  - 客户端程序要同时处理多个 socket
  - 客户端程序要同时处理用户输入和网络连接
  - TCP 服务器同时处理监听 socket 和连接 socket
  - 服务器同时处理 TCP 和 UDP 请求
  - 服务器同时监听多个端口，或处理多种服务
- I/O 复用本身是阻塞的，按顺序一次处理文件描述符，串行工作
- 若要实现并发，只能使用多进程或多线程等手段

### select

- 在一段指定时间内，监听用户感兴趣的文件描述符上的可读、可写或异常等事件

```C
#include <sys/select.h>
int select(int nfds, fd_set* readfds, fd_set* writefds, fd_set* exceptfds, struct timeval* timeout);

struct timeval
{
    long tv_sec;  //秒
    long tv_user; //微秒
}

#include <typesizes.h>
#define __FD_SETSIZE 1024
#define FD_SETSIZE __FD_SETSIZE   // fd_set能容纳的文件描述符数量
typedef long int __fd_mask;
#undef __NFDBITS
#define __NFDBITS {8 * (int) sizeof (__fd_mask)}
typedef struct
{
#ifdef __USE_XOPEN
    __fd_mask fds_bits[__FD_SETSIZE / __NFDBITS];
# define __FDS_BITS(set) ({set}->fds_bits)
#else
    __fd_mask __fds_bits[__FD_SETSIZE / __NFDBITS];
# define __FDS_BITS(set) ({set}->fds_bits)
#endif
} fd_set;
```

- nfds 指定被监听的文件描述符的总数
- readfds、writefds、exceptfds 指向可读、可写、异常等事件对应的文件描述符集合
- timeout 设置函数超时时间
